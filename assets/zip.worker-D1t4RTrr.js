(function(){"use strict";var h=Uint8Array,U=Uint16Array,hr=Int32Array,j=new h([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),b=new h([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gr=new h([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_=function(r,e){for(var n=new U(31),a=0;a<31;++a)n[a]=e+=1<<r[a-1];for(var f=new hr(n[30]),a=1;a<30;++a)for(var t=n[a];t<n[a+1];++t)f[t]=t-n[a]<<5|a;return{b:n,r:f}},d=_(j,2),rr=d.b,wr=d.r;rr[28]=258,wr[258]=28;for(var pr=_(b,0),yr=pr.b,X=new U(32768),v=0;v<32768;++v){var k=(v&43690)>>1|(v&21845)<<1;k=(k&52428)>>2|(k&13107)<<2,k=(k&61680)>>4|(k&3855)<<4,X[v]=((k&65280)>>8|(k&255)<<8)>>1}for(var B=(function(r,e,n){for(var a=r.length,f=0,t=new U(e);f<a;++f)r[f]&&++t[r[f]-1];var u=new U(e);for(f=1;f<e;++f)u[f]=u[f-1]+t[f-1]<<1;var s;if(n){s=new U(1<<e);var g=15-e;for(f=0;f<a;++f)if(r[f])for(var c=f<<4|r[f],l=e-r[f],i=u[r[f]-1]++<<l,o=i|(1<<l)-1;i<=o;++i)s[X[i]>>g]=c}else for(s=new U(a),f=0;f<a;++f)r[f]&&(s[f]=X[u[r[f]-1]++]>>15-r[f]);return s}),R=new h(288),v=0;v<144;++v)R[v]=8;for(var v=144;v<256;++v)R[v]=9;for(var v=256;v<280;++v)R[v]=7;for(var v=280;v<288;++v)R[v]=8;for(var er=new h(32),v=0;v<32;++v)er[v]=5;var mr=B(R,9,1),Cr=B(er,5,1),Z=function(r){for(var e=r[0],n=1;n<r.length;++n)r[n]>e&&(e=r[n]);return e},y=function(r,e,n){var a=e/8|0;return(r[a]|r[a+1]<<8)>>(e&7)&n},q=function(r,e){var n=e/8|0;return(r[n]|r[n+1]<<8|r[n+2]<<16)>>(e&7)},Sr=function(r){return(r+7)/8|0},G=function(r,e,n){return(e==null||e<0)&&(e=0),(n==null||n>r.length)&&(n=r.length),new h(r.subarray(e,n))},Fr=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],w=function(r,e,n){var a=new Error(e||Fr[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,w),!n)throw a;return a},kr=function(r,e,n,a){var f=r.length,t=a?a.length:0;if(!f||e.f&&!e.l)return n||new h(0);var u=!n,s=u||e.i!=2,g=e.i;u&&(n=new h(f*3));var c=function(ur){var sr=n.length;if(ur>sr){var cr=new h(Math.max(sr*2,ur));cr.set(n),n=cr}},l=e.f||0,i=e.p||0,o=e.b||0,S=e.l,x=e.d,E=e.m,T=e.n,A=f*8;do{if(!S){l=y(r,i,1);var K=y(r,i+1,3);if(i+=3,K)if(K==1)S=mr,x=Cr,E=9,T=5;else if(K==2){var Q=y(r,i,31)+257,nr=y(r,i+10,15)+4,ar=Q+y(r,i+5,31)+1;i+=14;for(var D=new h(ar),V=new h(19),p=0;p<nr;++p)V[gr[p]]=y(r,i+p*3,7);i+=nr*3;for(var fr=Z(V),Rr=(1<<fr)-1,Dr=B(V,fr,1),p=0;p<ar;){var ir=Dr[y(r,i,Rr)];i+=ir&15;var F=ir>>4;if(F<16)D[p++]=F;else{var M=0,W=0;for(F==16?(W=3+y(r,i,3),i+=2,M=D[p-1]):F==17?(W=3+y(r,i,7),i+=3):F==18&&(W=11+y(r,i,127),i+=7);W--;)D[p++]=M}}var or=D.subarray(0,Q),z=D.subarray(Q);E=Z(or),T=Z(z),S=B(or,E,1),x=B(z,T,1)}else w(1);else{var F=Sr(i)+4,N=r[F-4]|r[F-3]<<8,P=F+N;if(P>f){g&&w(0);break}s&&c(o+N),n.set(r.subarray(F,P),o),e.b=o+=N,e.p=i=P*8,e.f=l;continue}if(i>A){g&&w(0);break}}s&&c(o+131072);for(var Ir=(1<<E)-1,Wr=(1<<T)-1,Y=i;;Y=i){var M=S[q(r,i)&Ir],O=M>>4;if(i+=M&15,i>A){g&&w(0);break}if(M||w(2),O<256)n[o++]=O;else if(O==256){Y=i,S=null;break}else{var vr=O-254;if(O>264){var p=O-257,I=j[p];vr=y(r,i,(1<<I)-1)+rr[p],i+=I}var $=x[q(r,i)&Wr],L=$>>4;$||w(3),i+=$&15;var z=yr[L];if(L>3){var I=b[L];z+=q(r,i)&(1<<I)-1,i+=I}if(i>A){g&&w(0);break}s&&c(o+131072);var tr=o+vr;if(o<z){var lr=t-z,Xr=Math.min(z,tr);for(lr+o<0&&w(3);o<Xr;++o)n[o]=a[lr+o]}for(;o<tr;++o)n[o]=n[o-z]}}e.l=S,e.p=Y,e.b=o,e.f=l,S&&(l=1,e.m=E,e.d=x,e.n=T)}while(!l);return o!=n.length&&u?G(n,0,o):n.subarray(0,o)},xr=new h(0),C=function(r,e){return r[e]|r[e+1]<<8},m=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},H=function(r,e){return m(r,e)+m(r,e+4)*4294967296};function Ar(r,e){return kr(r,{i:2},e&&e.out,e&&e.dictionary)}var J=typeof TextDecoder<"u"&&new TextDecoder,zr=0;try{J.decode(xr,{stream:!0}),zr=1}catch{}var Er=function(r){for(var e="",n=0;;){var a=r[n++],f=(a>127)+(a>223)+(a>239);if(n+f>r.length)return{s:e,r:G(r,n-1)};f?f==3?(a=((a&15)<<18|(r[n++]&63)<<12|(r[n++]&63)<<6|r[n++]&63)-65536,e+=String.fromCharCode(55296|a>>10,56320|a&1023)):f&1?e+=String.fromCharCode((a&31)<<6|r[n++]&63):e+=String.fromCharCode((a&15)<<12|(r[n++]&63)<<6|r[n++]&63):e+=String.fromCharCode(a)}};function Tr(r,e){if(e){for(var n="",a=0;a<r.length;a+=16384)n+=String.fromCharCode.apply(null,r.subarray(a,a+16384));return n}else{if(J)return J.decode(r);var f=Er(r),t=f.s,n=f.r;return n.length&&w(8),t}}var Ur=function(r,e){return e+30+C(r,e+26)+C(r,e+28)},Mr=function(r,e,n){var a=C(r,e+28),f=Tr(r.subarray(e+46,e+46+a),!(C(r,e+8)&2048)),t=e+46+a,u=m(r,e+20),s=n&&u==4294967295?Or(r,t):[u,m(r,e+24),m(r,e+42)],g=s[0],c=s[1],l=s[2];return[C(r,e+10),g,c,f,t+C(r,e+30)+C(r,e+32),l]},Or=function(r,e){for(;C(r,e)!=1;e+=4+C(r,e+2));return[H(r,e+12),H(r,e+4),H(r,e+20)]};function Br(r,e){for(var n={},a=r.length-22;m(r,a)!=101010256;--a)(!a||r.length-a>65558)&&w(13);var f=C(r,a+8);if(!f)return{};var t=m(r,a+16),u=t==4294967295||f==65535;if(u){var s=m(r,a-12);u=m(r,s)==101075792,u&&(f=m(r,s+32),t=m(r,s+48))}for(var g=e&&e.filter,c=0;c<f;++c){var l=Mr(r,t,u),i=l[0],o=l[1],S=l[2],x=l[3],E=l[4],T=l[5],A=Ur(r,T);t=E,(!g||g({name:x,size:o,originalSize:S,compression:i}))&&(i?i==8?n[x]=Ar(r.subarray(A,A+o),{out:new h(S)}):w(14,"unknown compression type "+i):n[x]=G(r,A,A+o))}return n}self.onmessage=async function(e){const{type:n,file:a}=e.data;if(n==="EXTRACT")try{const f=await a.arrayBuffer(),t=new Uint8Array(f),u=[],s=Br(t,{filter:c=>c.name.toLowerCase().endsWith(".trc3")});for(const[c,l]of Object.entries(s))u.push({name:c.split("/").pop()||c,buffer:l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)});const g={type:"SUCCESS",files:u};self.postMessage(g)}catch(f){const t={type:"ERROR",error:f.message||"Unknown error during unzip"};self.postMessage(t)}}})();
